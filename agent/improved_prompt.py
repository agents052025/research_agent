"""
Модуль з покращеним системним промптом для CodeAgent в smolagents.
Цей промпт допомагає уникнути помилок парсингу коду.
"""

import os
from smolagents import Tool

# Базовий системний промпт з чіткими інструкціями форматування коду
IMPROVED_SYSTEM_PROMPT = """
Ти - дослідницький агент, який аналізує інформацію та виконує запити користувача.
Дотримуйся наступного формату при виконанні завдань:

1. **Думка**: Спочатку поясни свої міркування і план дій. Що ти збираєшся робити і чому.

2. **Код**: Якщо тобі потрібно виконати якусь дію, використовуй блок коду з ОБОВ'ЯЗКОВИМИ позначками:
```py
# Твій Python код тут
# Наприклад:
search_results = web_search(query="твій пошуковий запит", engine="google")
```

3. **Аналіз результатів**: Після отримання результатів, проаналізуй їх та поясни, що вони означають.

ВАЖЛИВО: Завжди розміщуй код між маркерами ```py і ``` - ці маркери необхідні для парсингу коду!
Навіть якщо твій код складається з одного рядка, він все одно має бути обрамлений цими маркерами.

В кінці для формування остаточної відповіді використовуй:
```py
final_answer({"summary_of_findings": "...", "key_insights": "...", "sources_used": "...", "limitations_of_the_research": "..."})
```

Пам'ятай, що твій код буде виконуватися в середовищі Python, тому він має бути синтаксично правильним.
"""

def create_agent_with_improved_prompt(tools, model, **kwargs):
    """
    Створює CodeAgent з покращеним системним промптом для уникнення помилок парсингу.
    
    Args:
        tools: Список інструментів для агента
        model: Модель для генерації відповідей
        **kwargs: Додаткові параметри для CodeAgent
        
    Returns:
        Екземпляр CodeAgent з покращеним промптом
    """
    from smolagents import CodeAgent
    
    # У версії smolagents, яка використовується, немає підтримки system_prompt в CodeAgent
    # Замість цього ми можемо тільки вивести рекомендації в лог
    print("\nВажлива інформація для моделі:")
    print("" + IMPROVED_SYSTEM_PROMPT)
    print("\nВикористовуйте ці інструкції при формуванні промпту для моделі.\n")
    
    # Створюємо агента без параметра system_prompt
    return CodeAgent(
        tools=tools,
        model=model,
        **kwargs
    )
